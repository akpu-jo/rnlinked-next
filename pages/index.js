import Head from "next/head";
import Image from "next/image";
import Header from "../components/navs/Header";
import { useSession, signIn, signOut } from "next-auth/react";
import MobileNav from "../components/navs/MobileNav";
import { PostCard } from "@/components/post/PostCard";
import { Timeline } from "@/components/users/Timeline";
import connectDb from "@/utils/db";
import Post from "@/models/postModel";
import Welcome from "./welcome";
import axios from "axios";

export default function Home({posts}) {
  const { data: session } = useSession();
  // const posts = JSON.parse(p);

  const head = () => {

    return (
      <Head>
        <title>Create Next App</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
    );
  };

  if (session) {
    return (
      <>
        {head()}
        <Header /> 
        {/* <pre>{JSON.stringify(session, null, 4)}</pre> */}
        <Timeline posts={posts} />
        <MobileNav user={session.user} />
        {/* <pre className="text-7xl">{JSON.stringify(session, null, 2)}</pre> */}
      </>
    );
  }
  return (
    <>
      {head()}
      <Welcome />
      Not signed in <br />
      <button onClick={() => signIn()}>Sign in</button>
    </>
  );
}

export const getServerSideProps = async (context) => {

  // await connectDb();

  // const posts = await Post.find().populate(
  //   "userId",
  //   "name username image"
  // ).sort({createdAt: -1});

  const {data} =   await axios.get(`http://localhost:3000/api/posts`)


  return {
    props: {
      posts: data.posts,
    },
  };
};
